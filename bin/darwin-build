#!/bin/sh -e
#
# Copyright (c) 2022 Dustin Lyons <dustin@zeroedlabs.com>

VERSION=1.0

GREEN='\033[1;32m'
RED='\033[1;31m'
CLEAR='\033[0m'

export NIXPKGS_ALLOW_UNFREE=1

echo "${GREEN}Starting...${CLEAR}"
nix --experimental-features 'nix-command flakes' build .#darwinConfigurations.Dustins-MBP.system --impure $@

echo "${GREEN}Switching to new generation...${CLEAR}"
./result/sw/bin/darwin-rebuild switch --flake .#Dustins-MBP --impure $@

echo "${GREEN}Cleaning up...${CLEAR}"
rm -rf ./result

echo "${GREEN}Done!${CLEAR}"
